##### **ç›®å‰æœ¬ä»“åº“åªæ¥æ”¶0.1çš„prï¼ï¼ï¼**
ğŸ‰v0.2æ’ä»¶***ä»“åº“***ç›®å‰æˆåŠŸé€‚é…ï¼ğŸ‰
##### ï¼ˆè½¬è½½è‡ªéº¦éº¦å¼€å‘æ–‡æ¡£ï¼‰
# æ’ä»¶ç»“æ„ç¤ºä¾‹
æœ¬æ–‡æ¡£æä¾›äº†å‡ ç§å¸¸è§æ’ä»¶ç±»å‹çš„å®Œæ•´ä»£ç ç¤ºä¾‹ï¼Œå¯ä»¥ä½œä¸ºå¼€å‘è‡ªå·±æ’ä»¶çš„å‚è€ƒã€‚

æ™ºèƒ½è‡ªé€‚åº”æ’ä»¶ï¼ˆæ¨èï¼‰

```python
from src.common.logger_manager import get_logger
from src.chat.actions.plugin_action import PluginAction, register_action, ActionActivationType
from src.chat.chat_mode import ChatMode
from typing import Tuple

logger = get_logger("your_action_name")

@register_action
class YourAction(PluginAction):
    """ä½ çš„åŠ¨ä½œæè¿°"""

    action_name = "your_action_name"
    action_description = "è¿™ä¸ªåŠ¨ä½œçš„è¯¦ç»†æè¿°ï¼Œä¼šå±•ç¤ºç»™ç”¨æˆ·"
    
    # åŒæ¿€æ´»ç±»å‹é…ç½®ï¼ˆæ™ºèƒ½è‡ªé€‚åº”æ¨¡å¼ï¼‰
    focus_activation_type = ActionActivationType.LLM_JUDGE      # Focusæ¨¡å¼ä½¿ç”¨æ™ºèƒ½åˆ¤å®š
    normal_activation_type = ActionActivationType.KEYWORD       # Normalæ¨¡å¼ä½¿ç”¨å…³é”®è¯
    activation_keywords = ["å…³é”®è¯1", "å…³é”®è¯2", "keyword"]
    keyword_case_sensitive = False
    
    # æ¨¡å¼å’Œå¹¶è¡Œæ§åˆ¶
    mode_enable = ChatMode.ALL      # æ”¯æŒæ‰€æœ‰æ¨¡å¼
    parallel_action = False         # æ ¹æ®éœ€è¦è°ƒæ•´
    enable_plugin = True            # æ˜¯å¦å¯ç”¨æ’ä»¶
    
    # ä¼ ç»Ÿé…ç½®
    action_parameters = {
        "param1": "å‚æ•°1çš„è¯´æ˜ï¼ˆå¯é€‰ï¼‰",
        "param2": "å‚æ•°2çš„è¯´æ˜ï¼ˆå¯é€‰ï¼‰"
    }
    action_require = [
        "ä½¿ç”¨åœºæ™¯1",
        "ä½¿ç”¨åœºæ™¯2"
    ]
    default = False

    associated_types = ["text", "command"]

    async def process(self) -> Tuple[bool, str]:
        """æ’ä»¶æ ¸å¿ƒé€»è¾‘"""
        # ä½ çš„ä»£ç é€»è¾‘...
        return True, "æ‰§è¡Œç»“æœ"
```
## å…³é”®è¯è§¦å‘æ’ä»¶

```python
@register_action
class SearchAction(PluginAction):
    action_name = "search_action"
    action_description = "æ™ºèƒ½æœç´¢åŠŸèƒ½"
    
    # ä¸¤ä¸ªæ¨¡å¼éƒ½ä½¿ç”¨å…³é”®è¯è§¦å‘
    focus_activation_type = ActionActivationType.KEYWORD
    normal_activation_type = ActionActivationType.KEYWORD
    activation_keywords = ["æœç´¢", "æŸ¥æ‰¾", "ä»€ä¹ˆæ˜¯", "search", "find"]
    keyword_case_sensitive = False
    
    mode_enable = ChatMode.ALL
    parallel_action = False
    enable_plugin = True
    
    async def process(self) -> Tuple[bool, str]:
        # æœç´¢é€»è¾‘
        query = self.action_data.get("query", "")
        if not query:
            return False, "æ²¡æœ‰æä¾›æœç´¢å…³é”®è¯"
            
        # æœç´¢å®ç°...
        result = f"å…³äº {query} çš„æœç´¢ç»“æœ..."
        return True, result
```
## å¹¶è¡Œè¾…åŠ©åŠ¨ä½œ

```python
@register_action
class EmotionAction(PluginAction):
    action_name = "emotion_action"
    action_description = "æƒ…æ„Ÿè¡¨è¾¾åŠ¨ä½œ"
    
    focus_activation_type = ActionActivationType.LLM_JUDGE
    normal_activation_type = ActionActivationType.RANDOM
    random_activation_probability = 0.05  # 5%æ¦‚ç‡
    
    mode_enable = ChatMode.ALL
    parallel_action = True  # ä¸å›å¤å¹¶è¡Œæ‰§è¡Œ
    enable_plugin = True
    
    async def process(self) -> Tuple[bool, str]:
        # è·å–æœ€è¿‘æ¶ˆæ¯
        messages = self.get_recent_messages(count=3)
        
        # æƒ…æ„Ÿåˆ†æé€»è¾‘...
        emotion = "happy"  # åˆ†æç»“æœ
        
        # å‘é€è¡¨æƒ…åŒ…æˆ–æƒ…æ„Ÿè¡¨è¾¾
        if emotion == "happy":
            await self.send_message(type="text", data="ğŸ˜Š")
        elif emotion == "sad":
            await self.send_message(type="text", data="ğŸ˜¢")
        
        # å¹¶è¡ŒåŠ¨ä½œé€šå¸¸ä¸è¿”å›æ–‡æœ¬
        return True, ""
```
## Focusä¸“äº«é«˜çº§åŠŸèƒ½

```python
@register_action
class AdvancedAnalysisAction(PluginAction):
    action_name = "advanced_analysis"
    action_description = "é«˜çº§åˆ†æåŠŸèƒ½"
    
    focus_activation_type = ActionActivationType.LLM_JUDGE
    normal_activation_type = ActionActivationType.ALWAYS  # ä¸ä¼šç”Ÿæ•ˆ
    
    mode_enable = ChatMode.FOCUS  # ä»…åœ¨Focusæ¨¡å¼å¯ç”¨
    parallel_action = False
    enable_plugin = True
    
    async def process(self) -> Tuple[bool, str]:
        # è·å–å¯ç”¨æ¨¡å‹
        models = self.get_available_models()
        
        # ä½¿ç”¨é«˜çº§æ¨¡å‹è¿›è¡Œåˆ†æ
        success, response, reasoning, model_name = await self.generate_with_model(
            prompt="è¿›è¡Œé«˜çº§åˆ†æçš„æç¤ºè¯",
            model_config=models["advanced_model"],
            max_tokens=2000
        )
        
        if not success:
            return False, "åˆ†æå¤±è´¥"
            
        return True, f"åˆ†æç»“æœï¼š{response}"
```
## ç¦è¨€åŠŸèƒ½ç¤ºä¾‹

```python
@register_action
class MuteAction(PluginAction):
    action_name = "mute_action"
    action_description = "ç¦è¨€ç¾¤æˆå‘˜"
    
    focus_activation_type = ActionActivationType.KEYWORD
    normal_activation_type = ActionActivationType.KEYWORD
    activation_keywords = ["ç¦è¨€", "å£çƒ", "ban", "mute"]
    keyword_case_sensitive = False
    
    mode_enable = ChatMode.ALL
    parallel_action = False
    enable_plugin = True
    
    action_parameters = {
        "target": "è¦ç¦è¨€çš„ç›®æ ‡",
        "duration": "ç¦è¨€æ—¶é•¿ï¼ˆç§’ï¼‰",
        "reason": "ç¦è¨€åŸå› ï¼ˆå¯é€‰ï¼‰"
    }
    
    async def process(self) -> Tuple[bool, str]:
        # è·å–å‚æ•°
        target = self.action_data.get("target", "")
        duration_str = self.action_data.get("duration", "60")
        reason = self.action_data.get("reason", "æœªæŒ‡å®šåŸå› ")
        
        # æ£€æŸ¥èŠå¤©ç±»å‹
        chat_type = self.get_chat_type()
        if chat_type != "group":
            return False, "ç¦è¨€åŠŸèƒ½ä»…åœ¨ç¾¤èŠä¸­å¯ç”¨"
            
        # è·å–ç”¨æˆ·ID
        try:
            platform, user_id = await self.get_user_id_by_person_name(target)
        except Exception as e:
            logger.error(f"{self.log_prefix} è·å–ç”¨æˆ·IDå¤±è´¥: {e}")
            return False, f"æ— æ³•è¯†åˆ«ç”¨æˆ· {target}"
            
        # å‘é€ç¦è¨€å‘½ä»¤
        try:
            await self.send_message(
                type="command",
                data={"name": "GROUP_BAN", "args": {"qq_id": str(user_id), "duration": duration_str}},
                display_message=f"æˆ‘å·²ç¦è¨€ {target} {duration_str}ç§’ï¼ŒåŸå› ï¼š{reason}"
            )
            return True, f"å·²ç¦è¨€ {target} {duration_str}ç§’"
        except Exception as e:
            logger.error(f"{self.log_prefix} ç¦è¨€å¤±è´¥: {e}")
            return False, "ç¦è¨€æ“ä½œå¤±è´¥"
```
ï¼ˆéº¦éº¦å®˜æ–¹æ–‡æ¡£ï¼‰æœ€åæ›´æ–°: 2025/6/15 01:22
ï¼ˆæœ¬æ–‡æ¡£ï¼‰æœ€åæ›´æ–°: 2025/6/18 10:10
